# 统一响应格式规范

## 概述
为CoinSec个人记账系统制定统一的API响应格式标准，确保所有接口返回一致的数据结构，提升前后端协作效率。

## 响应格式设计原则
1. **一致性** - 所有接口使用相同的响应结构
2. **简洁性** - 只包含必要的字段信息
3. **可扩展性** - 支持未来功能扩展
4. **语义化** - 字段命名清晰易懂

## 基础响应结构

### 成功响应格式
```json
{
    "code": 200,
    "message": "操作成功",
    "data": {},
    "timestamp": "2026-03-01T16:45:30.123+08:00"
}
```

### 错误响应格式
```json
{
    "code": 400,
    "message": "请求参数错误",
    "data": null,
    "timestamp": "2026-03-01T16:45:30.123+08:00",
    "errors": [
        {
            "field": "username",
            "message": "用户名不能为空"
        }
    ]
}
```

## 字段说明

### 必填字段
| 字段名 | 类型 | 说明 | 示例值 |
|-------|------|------|--------|
| code | integer | 响应状态码 | 200, 400, 500 |
| message | string | 响应消息 | "操作成功" |
| data | object/null | 响应数据 | {} 或 null |
| timestamp | string | 响应时间戳 | "2026-03-01T16:45:30.123+08:00" |

### 可选字段
| 字段名 | 类型 | 说明 | 出现场景 |
|-------|------|------|----------|
| errors | array | 错误详情列表 | 错误响应时出现 |
| requestId | string | 请求唯一标识 | 调试追踪时使用 |

## 状态码规范

### 成功状态码
| 状态码 | 说明 | 使用场景 |
|-------|------|----------|
| 200 | 请求成功 | GET查询、PUT更新等操作 |
| 201 | 创建成功 | POST新增资源 |
| 204 | 无内容 | DELETE删除成功 |

### 客户端错误码
| 状态码 | 说明 | 使用场景 |
|-------|------|----------|
| 400 | 请求参数错误 | 参数校验失败 |
| 401 | 未授权 | Token无效或过期 |
| 403 | 权限不足 | 无操作权限 |
| 404 | 资源不存在 | 查询的资源未找到 |
| 409 | 资源冲突 | 数据重复、状态冲突 |

### 服务器错误码
| 状态码 | 说明 | 使用场景 |
|-------|------|----------|
| 500 | 服务器内部错误 | 系统异常 |
| 503 | 服务不可用 | 系统维护中 |

## 业务错误码规范

### 用户模块 (1xxxx)
| 错误码 | 说明 | 使用场景 |
|-------|------|----------|
| 10001 | 参数验证失败 | 注册/登录参数错误 |
| 10002 | 用户不存在 | 用户名或ID无效 |
| 10003 | 密码错误 | 登录密码不匹配 |
| 10004 | 账户已被禁用 | 用户账号状态异常 |

### 账户模块 (2xxxx)
| 错误码 | 说明 | 使用场景 |
|-------|------|----------|
| 20001 | 账户不存在 | 账户ID无效 |
| 20002 | 余额不足 | 转账或消费金额超限 |
| 20003 | 账户名称已存在 | 创建账户时重名 |
| 20004 | 账户已被禁用 | 账户状态异常 |

### 分类模块 (3xxxx)
| 错误码 | 说明 | 使用场景 |
|-------|------|----------|
| 30001 | 分类不存在 | 分类ID无效 |
| 30002 | 不能删除系统分类 | 删除受保护的分类 |
| 30003 | 分类名称已存在 | 创建分类时重名 |

### 交易模块 (4xxxx)
| 错误码 | 说明 | 使用场景 |
|-------|------|----------|
| 40001 | 交易记录不存在 | 交易ID无效 |
| 40002 | 转账账户不能相同 | 转账时源目账户相同 |
| 40003 | 交易金额必须大于0 | 金额参数错误 |

## 响应数据(data)规范

### 列表数据格式
```json
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "content": [
            {
                "id": "550e8400-e29b-41d4-a716-446655440000",
                "name": "支付宝-日常"
            }
        ],
        "pageable": {
            "pageNumber": 1,
            "pageSize": 10,
            "totalElements": 100,
            "totalPages": 10
        }
    },
    "timestamp": "2026-03-01T16:45:30.123+08:00"
}
```

### 单个对象格式
```json
{
    "code": 200,
    "message": "获取成功",
    "data": {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "name": "支付宝-日常",
        "balance": 1000.00
    },
    "timestamp": "2026-03-01T16:45:30.123+08:00"
}
```

### 空数据格式
```json
{
    "code": 200,
    "message": "操作成功",
    "data": null,
    "timestamp": "2026-03-01T16:45:30.123+08:00"
}
```

## 错误详情(errors)规范

### 单字段错误
```json
{
    "code": 400,
    "message": "请求参数错误",
    "data": null,
    "timestamp": "2026-03-01T16:45:30.123+08:00",
    "errors": [
        {
            "field": "username",
            "message": "用户名不能为空"
        }
    ]
}
```

### 多字段错误
```json
{
    "code": 400,
    "message": "请求参数错误",
    "data": null,
    "timestamp": "2026-03-01T16:45:30.123+08:00",
    "errors": [
        {
            "field": "username",
            "message": "用户名不能为空"
        },
        {
            "field": "password",
            "message": "密码长度至少8位"
        }
    ]
}
```

### 全局错误
```json
{
    "code": 400,
    "message": "请求参数错误",
    "data": null,
    "timestamp": "2026-03-01T16:45:30.123+08:00",
    "errors": [
        {
            "field": "",
            "message": "请求体格式不正确"
        }
    ]
}
```

## 时间格式规范
- **格式**: ISO 8601 标准格式
- **示例**: `2026-03-01T16:45:30.123+08:00`
- **时区**: 统一时区 (+08:00 中国标准时间)

## 实施建议

### 开发阶段
1. 创建统一的响应包装类
2. 在全局异常处理器中统一处理错误响应
3. 使用拦截器记录请求响应日志
4. 建立API文档自动生成机制

### 测试阶段
1. 编写响应格式单元测试
2. 进行接口响应一致性验证
3. 压力测试响应性能
4. 安全测试响应信息泄露

### 生产环境
1. 监控响应时间和成功率
2. 收集错误响应统计信息
3. 定期审查响应格式规范
4. 根据反馈持续优化

## 版本管理
- **当前版本**: v1.0
- **生效日期**: 2026-03-01
- **维护者**: 后端开发团队
- **更新频率**: 根据业务需求定期评审

---
*此规范为CoinSec个人记账系统API响应的标准约定，所有开发人员必须严格遵守。*